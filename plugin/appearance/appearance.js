(function(d,y){typeof exports=="object"&&typeof module<"u"?module.exports=y():typeof define=="function"&&define.amd?define(y):(d=typeof globalThis<"u"?globalThis:d||self,d.Appearance=y())})(this,function(){"use strict";var fe=Object.defineProperty;var de=(d,y,I)=>y in d?fe(d,y,{enumerable:!0,configurable:!0,writable:!0,value:I}):d[y]=I;var m=(d,y,I)=>de(d,typeof y!="symbol"?y+"":y,I);var d=typeof document<"u"?document.currentScript:null;const y=t=>{try{return JSON.parse(t)&&!!t}catch{return!1}},I=t=>Array.from(t.childNodes).some(e=>e.tagName==="SECTION"),U=(t,e,n)=>{for(const a of Array.from(t.attributes))a.nodeName.startsWith("data")&&a.nodeName!==n&&e.setAttribute(a.nodeName,a.nodeValue||"")},_=t=>{if(t==null)return"";let e="",n=t;return typeof n=="string"&&(n=n.replace(/[“”]/g,'"').replace(/[‘’]/g,"'")),y(t)?e=t:typeof t=="object"?e=JSON.stringify(t,null,2):typeof t=="string"&&(e=t.trim().replace(/'/g,'"').charAt(0)==="{"?t.trim().replace(/'/g,'"'):`{${t.trim().replace(/'/g,'"')}}`),e};(()=>{try{return!!(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:d&&d.tagName.toUpperCase()==="SCRIPT"&&d.src||new URL("plugin/appearance/appearance.js",document.baseURI).href)}catch{return!1}})();class D{constructor(){m(this,"debugMode",!1);m(this,"label","DEBUG");m(this,"log",(...e)=>{this.debugMode&&console.log(...e)});m(this,"warn",(...e)=>{this.debugMode&&console.warn(...e)});m(this,"error",(...e)=>{this.debugMode&&console.error(...e)});m(this,"info",(...e)=>{this.debugMode&&console.info(...e)});m(this,"labellog",(...e)=>{this.debugMode&&console.log(`[${this.label}]:`,...e)});m(this,"labelwarn",(...e)=>{this.debugMode&&console.warn(`[${this.label}]:`,...e)});m(this,"labelerror",(...e)=>{this.debugMode&&console.error(`[${this.label}]:`,...e)});m(this,"labelinfo",(...e)=>{this.debugMode&&console.info(`[${this.label}]:`,...e)});m(this,"group",(...e)=>{this.debugMode&&console.group(`[${this.label}]:`,...e)});m(this,"groupEnd",(...e)=>{this.debugMode&&console.groupEnd()})}initialize(e,n="DEBUG"){this.debugMode=e,this.label=n}}const v=new D;function q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var M,j;function P(){if(j)return M;j=1;var t=function(c){return e(c)&&!n(c)};function e(i){return!!i&&typeof i=="object"}function n(i){var c=Object.prototype.toString.call(i);return c==="[object RegExp]"||c==="[object Date]"||s(i)}var a=typeof Symbol=="function"&&Symbol.for,r=a?Symbol.for("react.element"):60103;function s(i){return i.$$typeof===r}function o(i){return Array.isArray(i)?[]:{}}function u(i,c){return c.clone!==!1&&c.isMergeableObject(i)?A(o(i),i,c):i}function l(i,c,f){return i.concat(c).map(function(S){return u(S,f)})}function p(i,c){if(!c.customMerge)return A;var f=c.customMerge(i);return typeof f=="function"?f:A}function h(i){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(i).filter(function(c){return Object.propertyIsEnumerable.call(i,c)}):[]}function b(i){return Object.keys(i).concat(h(i))}function C(i,c){try{return c in i}catch{return!1}}function w(i,c){return C(i,c)&&!(Object.hasOwnProperty.call(i,c)&&Object.propertyIsEnumerable.call(i,c))}function N(i,c,f){var S={};return f.isMergeableObject(i)&&b(i).forEach(function(g){S[g]=u(i[g],f)}),b(c).forEach(function(g){w(i,g)||(C(i,g)&&f.isMergeableObject(c[g])?S[g]=p(g,f)(i[g],c[g],f):S[g]=u(c[g],f))}),S}function A(i,c,f){f=f||{},f.arrayMerge=f.arrayMerge||l,f.isMergeableObject=f.isMergeableObject||t,f.cloneUnlessOtherwiseSpecified=u;var S=Array.isArray(c),g=Array.isArray(i),ce=S===g;return ce?S?f.arrayMerge(i,c,f):N(i,c,f):u(c,f)}A.all=function(c,f){if(!Array.isArray(c))throw new Error("first argument should be an array");return c.reduce(function(S,g){return A(S,g,f)},{})};var le=A;return M=le,M}var H=P();const x=q(H);var B=Object.defineProperty,z=(t,e,n)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,L=(t,e,n)=>z(t,typeof e!="symbol"?e+"":e,n);class F{constructor(e,n,a){L(this,"defaultConfig"),L(this,"pluginInit"),L(this,"pluginId"),L(this,"mergedConfig",null),L(this,"data",{}),typeof e=="string"?(this.pluginId=e,this.pluginInit=n,this.defaultConfig=a||{}):(this.pluginId=e.id,this.pluginInit=e.init,this.defaultConfig=e.defaultConfig||{})}initializeConfig(e){const n=this.defaultConfig,a=e.getConfig()[this.pluginId]||{};this.mergedConfig=x(n,a,{arrayMerge:(r,s)=>s,clone:!0})}getCurrentConfig(){if(!this.mergedConfig)throw new Error("Plugin configuration has not been initialized");return this.mergedConfig}getData(){return Object.keys(this.data).length>0?this.data:void 0}init(e){if(this.initializeConfig(e),this.pluginInit)return this.pluginInit(this,e,this.getCurrentConfig())}createInterface(e={}){return{id:this.pluginId,init:n=>this.init(n),getConfig:()=>this.getCurrentConfig(),getData:()=>this.getData(),...e}}}const J=t=>{const e=document.querySelector(`script[src$="${t}.js"], script[src$="${t}.min.js"], script[src$="${t}.mjs"]`);if(e!=null&&e.src){const n=e.getAttribute("src")||"",a=n.lastIndexOf("/");if(a!==-1)return n.substring(0,a+1)}try{if(typeof{url:typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:d&&d.tagName.toUpperCase()==="SCRIPT"&&d.src||new URL("plugin/appearance/appearance.js",document.baseURI).href}<"u"&&(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:d&&d.tagName.toUpperCase()==="SCRIPT"&&d.src||new URL("plugin/appearance/appearance.js",document.baseURI).href))return(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:d&&d.tagName.toUpperCase()==="SCRIPT"&&d.src||new URL("plugin/appearance/appearance.js",document.baseURI).href).slice(0,(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:d&&d.tagName.toUpperCase()==="SCRIPT"&&d.src||new URL("plugin/appearance/appearance.js",document.baseURI).href).lastIndexOf("/")+1)}catch{}return`plugin/${t}/`},$="data-css-id",k=(t,e,n)=>new Promise((a,r)=>{const s=document.createElement("link");s.rel="stylesheet",s.href=e,s.setAttribute($,t);const o=setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),n&&console.log(`[${t}] Timeout loading CSS from: ${e}`),r(new Error(`Timeout loading CSS from: ${e}`))},5e3);s.onload=()=>{clearTimeout(o),a()},s.onerror=()=>{clearTimeout(o),s.parentNode&&s.parentNode.removeChild(s),r(new Error(`Failed to load CSS from: ${e}`))},document.head.appendChild(s)}),V=t=>document.querySelectorAll(`[${$}="${t}"]`).length>0,G=async t=>{const{id:e,enableLoading:n=!0,userPath:a="",debug:r=!1}=t;if(n===!1||a===!1)return;if(V(e)){r&&console.log(`[${e}] CSS already loaded, skipping`);return}const s=[];if(typeof a=="string")a&&a.trim()!==""&&s.push(a);else if(Array.isArray(a)){const p=a.filter(h=>h&&h.trim()!=="");s.push(...p)}const o=J(e);if(o){const p=`${o}${e}.css`;s.push(p)}const u=`plugin/${e}/${e}.css`;s.push(u);const l=`plugins/${e}/${e}.css`;s.push(l);for(const p of s)try{await k(e,p,r);let h="CSS";a&&(typeof a=="string"?p===a:a.includes(p))?h="user-specified CSS":p===`${o}${e}.css`?h="CSS (through script detection)":h="CSS (fallback path)",r&&console.log(`[${e}] ${h} loaded successfully from: ${p}`);return}catch{r&&console.log(`[${e}] Failed to load CSS from: ${p}`)}console.warn(`[${e}] Could not load CSS from any location`)},Q={baseclass:"animate__animated",hideagain:!0,delay:300,appearevent:"slidetransitionend",autoappear:!1,autoelements:!1,appearparents:!1,cssautoload:!0,csspath:"",compatibility:!1,compatibilitybaseclass:"animated"};function W(t,e,n){const a={baseclass:t,compatibilitybaseclass:e,fragmentSelector:".fragment",fragmentClass:"fragment",speedClasses:["slower","slow","fast","faster"],animatecss:'[class^="animate__"],[class*=" animate__"]',eventnames:["ready","slidechanged","slidetransitionend","autoanimate","overviewhidden"]};return a.speedClasses=[...a.speedClasses,...a.speedClasses.map(r=>`animate__${r}`)],n&&(a.animatecss=".backInDown, .backInLeft, .backInRight, .backInUp, .bounceIn, .bounceInDown, .bounceInLeft, .bounceInRight, .bounceInUp, .fadeIn, .fadeInDown, .fadeInDownBig, .fadeInLeft, .fadeInLeftBig, .fadeInRight, .fadeInRightBig, .fadeInUp, .fadeInUpBig, .fadeInTopLeft, .fadeInTopRight, .fadeInBottomLeft, .fadeInBottomRight, .flipInX, .flipInY, .lightSpeedInRight, .lightSpeedInLeft, .rotateIn, .rotateInDownLeft, .rotateInDownRight, .rotateInUpLeft, .rotateInUpRight, .jackInTheBox, .rollIn, .zoomIn, .zoomInDown, .zoomInLeft, .zoomInRight, .zoomInUp, .slideInDown, .slideInLeft, .slideInRight, .slideInUp, .skidLeft, .skidLeftBig, .skidRight, .skidRightBig, .shrinkIn, .shrinkInBlur",a.baseclass=e),a}function Y(t,e,n){let a=null;if(t instanceof HTMLElement&&t.hasAttribute("data-autoappear")){let r=t.dataset.autoappear;r=="auto"||r==""||r=="true"?a=e.autoelements?e.autoelements:null:a=r}else e.autoappear&&e.autoelements&&(a=e.autoelements);if(a){let r=JSON.parse(_(a));Object.entries(r).forEach(([s,o])=>{let u=Array.from(t.querySelectorAll(s)).filter(l=>!n.includes(l));u.length&&u.forEach(l=>{n.push(l);let p=[],h=null,b=!1,C=null,w=null;Array.isArray(o)?(p=o[0].split(/[ ,]+/),h=o[1]):typeof o=="string"?p=o.split(/[ ,]+/):o&&typeof o=="object"&&((o.class||o.animation)&&(p=(o.animation?o.animation:o.class).split(/[ ,]+/)),o.speed&&(b=String(o.speed),b.includes("animate__")||(b=`animate__${b}`)),o.delay&&(h=String(o.delay)),o.split&&(C=String(o.split)),o["container-delay"]&&(w=String(o["container-delay"]))),l.classList.add(...p),b&&l.classList.add(b),l instanceof HTMLElement&&(h&&(l.dataset.delay||(l.dataset.delay=h)),C&&(l.dataset.split=C),w&&(l.dataset.containerDelay=w))})})}}function K(t,e){t.classList.contains(e.baseclass)||t.classList.add(e.baseclass),t.classList.contains(e.fragmentClass)&&t.classList.add("custom")}function O(t,e){const n=t.parentNode;if(n){for(const a of Array.from(n.children))if(a!==t&&a.dataset.appearParent)return;n instanceof Element&&(n.classList.value=t.classList.value,U(t,n,"data-appear-parent"),n.innerHTML=t.innerHTML,e&&n.classList.add(e))}}function X(t,e,n){const a=n.baseclass;if(t.hasAttribute("data-appear-parent")&&O(t,a),e.appearparents&&t.parentNode&&t.parentNode instanceof Element&&t.tagName==="SPAN"&&t.parentNode.tagName==="LI"){const r=t.outerHTML.length,s=t.parentNode.innerHTML.length;r===s&&O(t)}}function Z(t,e){var r,s;let n=!1,a=" ";if(e==="words"?n=((r=t.textContent)==null?void 0:r.trim().split(/\s+/))||[]:e==="letters"&&(n=((s=t.textContent)==null?void 0:s.trim().split(""))||[],a=""),n&&n.length>0){const o=Array.from(t.classList).filter(l=>l.startsWith("animate__")),u=n.map((l,p)=>{const h=document.createElement("span");return h.textContent=l,l===" "&&(h.textContent=" "),t.dataset.delay&&p!==0&&(h.dataset.delay=t.dataset.delay),t.dataset.containerDelay&&p===0&&(h.dataset.delay=t.dataset.containerDelay),o.forEach(b=>h.classList.add(b)),h.outerHTML}).join(a);t.classList.add("wordchargroup"),o.forEach(l=>t.classList.remove(l)),t.removeAttribute("data-delay"),t.removeAttribute("data-split"),t.removeAttribute("data-container-delay"),t.innerHTML=u}}function ee(t,e,n){return Array.from(n.querySelectorAll(`.${t}`)).filter(a=>!a.closest(`.${e}`))}function te(t,e,n){return Array.from(n.querySelectorAll(`.${t}`)).filter(a=>a.closest(`.${e}`)===n)}function ne(t,e,n){if(!e)return!1;const a=[ee(e,n,t),...Array.from(t.querySelectorAll(`.${n}`)).map(r=>te(e,n,r))];return a.some(r=>r.length>0)?a:!1}function ae(t,e,n){let a=0;t.forEach((r,s)=>{if(s===0&&r instanceof HTMLElement&&r.dataset.delay||s!==0){let o=e.delay;if(r instanceof HTMLElement&&r.dataset&&r.dataset.delay){const u=parseInt(r.dataset.delay);isNaN(u)||(o=u)}a=a+o,r instanceof HTMLElement&&(r.style.setProperty("animation-delay",a+"ms"),r.removeAttribute("data-delay"))}})}function re(t){return{from:t.fromSlide||t.previousSlide||null,to:t.toSlide||t.currentSlide||null}}function ie(t,e){t.dataset.appearevent&&t.dataset.appearevent==="auto"&&(t.dataset.appearevent="autoanimate");let n=e.appearevent;return n==="auto"&&(n="autoanimate"),t.dataset.appearevent||n}function E(t,e){e.hideagain&&t.from&&t.from.dataset.appearanceCanStart&&t.from.removeAttribute("data-appearance-can-start")}function R(t,e,n){if(e.hideagain&&t&&t.from){const a=t.from.querySelectorAll(n.animatecss);a&&a.forEach(s=>{s.classList.remove("animationended")});const r=t.from.querySelectorAll(".fragment.visible");r&&r.forEach(s=>{s.classList.remove("visible")})}}function se(t,e,n,a){const r=a.getViewportElement();a.getConfig().view;const o=r.classList.contains("reveal-scroll"),u=t.type,l=re(t);if(l.to){u==="ready"&&(l.to.dataset.appearanceCanStart="true");const p=ie(l.to,e);(u===p||u==="slidetransitionend"&&p==="autoanimate")&&(l.to.dataset.appearanceCanStart="true"),o&&u==="slidechanged"&&(E(l,e),R(l,e,n),setTimeout(()=>{l.to&&(l.to.dataset.appearanceCanStart="true")},e.delay)),u==="slidetransitionend"&&(E(l,e),R(l,e,n)),u==="slidechanged"&&document.body.dataset.exitoverview?(E(l,e),l.to.dataset.appearanceCanStart="true"):u==="overviewhidden"&&(document.body.dataset.exitoverview="true",setTimeout(()=>{document.body.removeAttribute("data-exitoverview")},500),t.currentSlide&&(E(l,e),l.to.dataset.appearanceCanStart="true"))}}class T{constructor(e,n){m(this,"deck");m(this,"viewport");m(this,"revealEl");m(this,"slides");m(this,"options");m(this,"consts");m(this,"sections");m(this,"regularSections");m(this,"fragments");m(this,"appearances");this.deck=e,this.options=n,this.viewport=e.getViewportElement(),this.revealEl=e.getRevealElement(),this.slides=e.getSlidesElement(),this.consts=W(n.baseclass,n.compatibilitybaseclass,n.compatibility),this.sections=this.slides.querySelectorAll("section"),this.regularSections=Array.from(this.sections).filter(a=>!I(a)),this.fragments=this.slides.querySelectorAll(this.consts.fragmentSelector),this.appearances=[],/receiver/i.test(window.location.search)&&this.viewport.classList.add("sv")}async prepareElements(){this.appearances=Array.from(this.slides.querySelectorAll(this.consts.animatecss)),this.regularSections.forEach(e=>Y(e,this.options,this.appearances)),this.appearances.forEach(e=>{X(e,this.options,this.consts),K(e,this.consts),e instanceof HTMLElement&&e.dataset.split&&Z(e,e.dataset.split)}),this.regularSections.forEach(e=>{const n=ne(e,this.consts.baseclass,this.consts.fragmentClass);n&&n.forEach(a=>ae(a,this.options,this.consts))})}setupEventListeners(){this.consts.eventnames.forEach(e=>{this.deck.on(e,n=>{se(n,this.options,this.consts,this.deck)})}),this.viewport.addEventListener("animationend",e=>{e.target.classList.add("animationended")}),this.viewport.addEventListener("fragmenthidden",e=>{e.fragment&&(e.fragment.classList.remove("animationended"),e.fragment.querySelectorAll(".animationended").forEach(n=>{n.classList.remove("animationended")}))})}static async create(e,n){v.group("Appearance Plugin");const a=new T(e,n);return await a.prepareElements(),a.setupEventListeners(),v.groupEnd(),a}}const oe=async(t,e,n)=>{v&&(n.debug||e.getConfig().debug)&&v.initialize(!0,"Appearance");const a=document.querySelector("meta[name=generator]");if(!(a instanceof HTMLMetaElement&&a.content.includes("quarto"))&&n.cssautoload)try{await G({id:t.pluginId,enableLoading:n.cssautoload,userPath:n.csspath,debug:n.debug})}catch(s){console.warn("CSS loading failed, but plugin will continue:",s)}await T.create(e,n)};return()=>new F("appearance",oe,Q).createInterface()});
